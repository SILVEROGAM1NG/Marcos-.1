/**
</> Original base BochilGaming 
</> Recode simple by @NeKosmic
**/

let handler=async(t,{conn:e,text:a})=>{if(e.hartatahta=e.hartatahta?e.hartatahta:{},t.chat in e.hartatahta)return t.reply("Aun estoy trabajando en una solicitud pendiente, por favor esperé su turno :D");e.hartatahta[t.chat]=!0;const n=await e.getName(t.sender);t.reply(MultiNK.Proces(n));try{const n=await ht(a||NombreDelBot);e.sendFile(t.chat,n,"HartaTahta.png","*© Nurutomo*\nEcho en FFmpeg "+(a.length>15?"\n\n_[Consejo] : Use saltos de linea para realizar un trabajo perfecto!_":""),t)}finally{delete e.hartatahta[t.chat]}};handler.help=["imgtxt <texto>"],handler.tags=["fabricar"],handler.command=/^imgtxt$/i,handler.limit=!0;export default handler;import{spawn}from"child_process";import{readdirSync,readFileSync,unlinkSync}from"fs";import{join}from"path";const __dirname=global.__dirname(import.meta.url),src=join(__dirname,"../multimedia/"),tmp=join(__dirname,"../tmp/"),_font=join(src,"font"),aesthetic=join(src,"Aesthetic");function ht(t=""){return new Promise(((e,a)=>{const n=join(aesthetic,pickRandom(readdirSync(aesthetic))),o=join(_font,"Roboto-Black.ttf"),r=1024,i=r,l=r+"x"+i,c=`(${noise("X",2,r,1)}+${noise("Y",1,i,1)})/2+128`,s=`((${pickRandom(["","-"])}22.5*${pickRandom(["sin","cos"])}(X/1024*4*PI))+${noise("X",5,r,.8)}+${noise("Y",2,i,1)})/1.7+128`,d=t.startsWith(NombreDelBot)?230:130,h=[`[v:0]scale=${l}[im]`,textArgs("","black","white",d,o,"(w-text_w)/2","(h-text_h)/2-(text_h*1.5)",r,i)+"[top]",textArgs(t,"black","white",d,o,"(w-text_w)/2","(h-text_h)/2",r,i)+"[mid]",textArgs("","black","white",d,o,"(w-text_w)/2","(h-text_h)/2+(text_h*1.5)",r,i)+"[bot]","[top][mid]blend=all_mode=addition[con]","[con][bot]blend=all_mode=addition[txt]",`nullsrc=s=${l},geq='r=${c}:g=${c}:b=${c}'[dx]`,`nullsrc=s=${l},geq='r=${s}:g=${s}:b=${s}'[dy]`,"[txt][dx][dy]displace[wa]","[im][wa]blend=all_mode=multiply:all_opacity=1"];let m=1*new Date+"_harta_tahta.png";m=join(tmp,m);const p=["-y","-i",n,"-filter_complex",h.join(";"),"-frames:v","1",m];spawn("ffmpeg",p).on("error",a).on("close",(()=>{try{e(readFileSync(m)),unlinkSync(m)}catch(t){a(t)}}))}))}function noise(t,e=4,a=1024,n){const o=[];for(let r=0;r<e;r++)o.push(formula(t,n*rand(40,80)*(a/2048)/a*((r+1)/5),rand(-Math.PI,Math.PI),(r+1)/e*8,0));return o.join("+")}function formula(t,e,a,n,o){return`(${o.toFixed(3)}+${n.toFixed(4)}*sin(${a.toFixed(6)}+2*PI*${t}*${e.toFixed(6)}))`}function textArgs(t,e,a,n,o,r="200",i="200",l=1024,c=1024){return`color=${e}:s=${l}x${c},drawtext=text='${t.replace(/[\\]/g,"\\$&")}':fontfile='${o.replace(/[\\]/g,"\\$&")}':x=${r}:y=${i}:fontsize=${n}:fontcolor=${a}`}function rand(t,e,a=.001){return Math.floor(Math.random()*(e-t)/a)*a}

/**
[_>] https://github.com/NeKosmic/
[_>] https://gitlab.com/NeKosmic/
**/